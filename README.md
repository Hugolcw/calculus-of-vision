# Sobel Universe: 视觉的微积分

<div align="center">

**从数学理想（Δx → 0）到工程现实（pixel = 1）**

[![Python](https://img.shields.io/badge/Python-3.8+-blue.svg)](https://www.python.org/)
[![Manim](https://img.shields.io/badge/Manim-0.17.0+-green.svg)](https://www.manim.community/)
[![License](https://img.shields.io/badge/License-MIT-yellow.svg)](LICENSE)

</div>

---

## 📖 项目简介

**Sobel Universe** 是一个数学可视化教育项目，通过精美的动画展示微积分中的**导数**概念如何从抽象的数学理论转化为实际的工程应用——**Sobel边缘检测算法**。

本项目是数学分析课程大作业，属于"数学与生活小故事录制"方向，通过学科交叉的方式（数学 × 计算机视觉 × 通信工程）展示数学在AI和图像处理中的应用。

### 🎯 核心主题

- **数学理想**：连续函数、无穷小、完美的导数定义（Δx → 0）
- **工程现实**：离散采样、像素化、有限差分（pixel = 1）
- **数学桥梁**：泰勒展开如何连接理想与现实
- **工程智慧**：Sobel算子如何平衡"变化"与"平稳"
- **视觉奇迹**：3D维度跃迁，展示边缘检测的视觉化过程

---

## ✨ 项目特点

- 🎬 **6个精心设计的场景**：从连续到离散，从一维到三维，完整的叙事结构
- 🎨 **视觉语义化设计**：颜色编码系统，每个颜色都有明确的数学含义
- 🔬 **数学严谨性**：基于泰勒展开的严格推导，展示中心差分法的数学基础
- 💻 **工程实用性**：展示Sobel算子的构造过程，包括卷积可分离性优化
- 🌐 **3D可视化**：将2D图像处理转化为3D地形扫描，直观展示导数的作用
- 📚 **教育价值**：适合数学分析、计算机视觉、信号处理等课程

---

## 🎬 场景结构

### Scene 1: 离散现实 (Discrete Reality)

**时长**: ~9.5秒 | **主题**: 连续与离散的对比

- 展示连续函数的理想状态（蓝色曲线）
- 演示采样过程，使用"幽灵"效果保留连续曲线
- 聚焦到离散采样点，引出核心问题：如何在离散世界中找回导数？

### Scene 2: 泰勒桥梁 (The Taylor Bridge)

**时长**: ~18.5秒 | **主题**: 数学推导

- 展示泰勒展开公式：f(x+1) 和 f(x-1)
- 演示项的对撞和抵消过程（数学的"消消乐"）
- 推导出中心差分公式：f'(x) ≈ [f(x+1) - f(x-1)] / 2
- 提取系数 [-1, 0, 1]，展示数学的精密投影

### Scene 3.5: 噪声的战争 (The War on Noise)

**时长**: ~14秒 | **主题**: 噪声处理

- **现实的残酷**：展示理想信号 vs 带噪声的真实信号
- **直接求导的灾难**：展示噪声被差分放大，导数变成锯齿状
- **高斯护盾**：展示高斯平滑的效果，解释为什么需要平滑
- 为Sobel算子的平滑部分提供理论支撑

### Scene 3: 算子解构 (Operator Anatomy)

**时长**: ~17秒 | **主题**: Sobel算子构造

- 展示微分向量 [-1, 0, 1]（红色，高通）和平滑向量 [1, 2, 1]ᵀ（青色，低通）
- 演示外积运算过程，生成最终的3×3 Sobel矩阵
- 高亮矩阵结构，展示"一手抓变化，一手抓平稳"的设计哲学
- **卷积可分离性**：展示计算效率对比（3+3 vs 3×3）

### Scene 4: 维度跃迁 (Dimensional Leap)

**时长**: ~23.5秒 | **主题**: 3D可视化与应用

- **2D阶段**：显示图像和扫描线，生成波形图
- **维度切换**：从2D转换为3D地形（亮度映射为高度）
- **全息扫描**：Sobel算子在3D地形上扫描，实时显示导数波形
- **像素级放大镜**：暂停扫描，放大到3×3像素格子，显示RGB数值和卷积计算过程
- **特征图生成**：显示边缘检测结果

### Scene 5: Outro - 知行合一

**时长**: ~17秒 | **主题**: 哲学升华

- 快速回顾关键元素（蒙太奇效果）
- 展示核心哲学思想："从数学理想到工程现实"
- 版权声明和工具说明

**总时长**: 约127.5秒（纯动画），含旁白预计6-7分钟，符合作业要求（≤ 8分钟）✅

---

## 🛠️ 技术栈

### 核心工具

- **Manim Community Edition** v0.17.0+ - 数学动画制作引擎
- **Python** 3.8+ - 编程语言
- **NumPy** - 数值计算
- **LaTeX** - 数学公式渲染

### 依赖库

```bash
pip install manim numpy
```

### 系统要求

- **操作系统**: Windows / Linux / macOS
- **内存**: 建议 8GB+（Scene 4 的 3D 渲染需要较多内存）
- **显卡**: 支持 OpenGL（用于 3D 渲染）
- **LaTeX**: TeX Live（Linux/Mac）或 MiKTeX（Windows）

---

## 🚀 快速开始

### 1. 环境准备

#### 安装 Python

确保已安装 Python 3.8 或更高版本：

```bash
python --version
```

#### 安装 Manim

```bash
pip install manim numpy
```

#### 安装 LaTeX

- **Windows**: 下载并安装 [MiKTeX](https://miktex.org/)
- **Linux**: `sudo apt-get install texlive-full`（Ubuntu/Debian）
- **macOS**: `brew install --cask mactex`（使用 Homebrew）

### 2. 渲染视频

#### 低质量预览（快速调试）

```bash
cd calculus-of-vision/final_version
manim -pql sobel_complete.py SobelUniverse
```

- **质量**: 480P
- **速度**: 快速（约5-10分钟）
- **用途**: 调试和预览

#### 高质量渲染（最终版本）

```bash
manim -pqh sobel_complete.py SobelUniverse
```

- **质量**: 1080P
- **速度**: 较慢（约30-60分钟，取决于硬件）
- **用途**: 最终提交

#### 参数说明

- `-p`: 渲染后自动预览
- `-ql`: Quality Low（低质量，快速）
- `-qm`: Quality Medium（中等质量）
- `-qh`: Quality High（高质量）

### 3. 输出位置

渲染后的视频位于：

```
media/videos/sobel_complete/[质量]/SobelUniverse.mp4
```

---

## 📁 项目结构

```
calculus-of-vision/
├── README.md                         # 项目技术文档（本文件）
├── final_version/                    # 最终版本文件夹
│   ├── sobel_complete.py            # 完整源代码（主文件）
│   ├── 脚本文档.md                   # 创作思路、作品意义、素材来源
│   ├── 说明.md                       # 组员名单、文件说明（提交用）
│   ├── 提交检查清单.md               # 提交前检查清单
│   ├── 旁白与剪辑指南.md             # 旁白脚本和剪辑建议
│   ├── 时长估算.md                   # 各场景时长分析
│   ├── 专家意见汇总.md               # 代码审查和优化建议
│   └── 提交指南.md                   # 作业提交要求
├── 一次性视频/                       # 开发过程中的测试版本
├── 代码框架.md                       # 代码架构说明
├── 代码功能实现模块.md               # 代码功能模块说明
├── 视频剧本.md                       # 视频剧本
└── 编码注意事项.md                   # 编码规范
```

---

## 🎨 设计理念

### 颜色语义系统

本项目采用语义化的颜色编码，每个颜色都有明确的数学含义：

| 颜色 | 代码常量 | 语义 | 应用场景 |
|------|---------|------|---------|
| 🔵 蓝色 | `COLOR_CONTINUOUS` | 理想数学、连续函数 | Scene 1 的连续曲线 |
| 🟡 黄色 | `COLOR_DISCRETE` | 工程采样、离散点 | Scene 1 的采样点 |
| 🔴 红色 | `COLOR_DIFF` | 微分/变化/高频 | 微分向量、切线 |
| 🔷 青色 | `COLOR_SMOOTH` | 平滑/保持/低频 | 平滑向量、高斯滤波 |
| ⚪ 灰色 | `COLOR_GHOST` | 过去的影子 | Scene 1 的幽灵曲线 |

### 视觉叙事原则

1. **对比强化**：通过颜色和动画对比，突出"理想 vs 现实"
2. **渐进揭示**：分步骤展示数学推导，避免信息过载
3. **维度跃迁**：从1D到2D再到3D，逐步提升视觉复杂度
4. **实时反馈**：Scene 4 的示波器实时显示导数波形，增强交互感

---

## 💻 开发指南

### 代码结构

```python
class SobelUniverse(ThreeDScene):
    def construct(self):
        # 全局设置
        self.camera.background_color = "#0e1111"
        
        # 按顺序调度各个场景
        self.setup_scene_1_discrete()
        self.transition_1_2()
        self.setup_scene_2_taylor()
        # ... 其他场景
```

### 单独测试某个场景

在 `construct()` 方法中，注释掉其他场景，只保留要测试的场景：

```python
def construct(self):
    # self.setup_scene_1_discrete()
    # self.transition_1_2()
    # self.setup_scene_2_taylor()
    self.setup_scene_4_vision()  # 只渲染这个场景
```

### 自定义图片

如果想要在 Scene 4 中使用真实图片，修改 `setup_scene_4_vision()` 方法：

```python
# 将图片路径替换为你的图片路径
image_data = get_downsampled_array("path/to/your/image.png", rate=10)
```

**注意**：务必进行降采样（`rate=10`），否则渲染会非常慢或卡死。

### 性能优化

1. **Scene 4 降采样**：代码中已包含 `get_downsampled_array()` 函数，自动降采样
2. **分辨率控制**：建议 Scene 4 的分辨率不超过 20×20
3. **调试模式**：开发时使用 `-pql` 快速预览，避免长时间等待

---

## ⚠️ 常见问题

### Q1: LaTeX 渲染错误？

**A**: 确保安装了完整的 LaTeX 发行版：

- Windows: MiKTeX（推荐，自动安装缺失的包）
- Linux: `sudo apt-get install texlive-full`
- macOS: `brew install --cask mactex`

### Q2: Scene 4 渲染卡死？

**A**:

- 代码中已包含降采样处理（`get_downsampled_array` 函数）
- 如果仍卡死，可以进一步增加降采样率（修改 `rate` 参数）
- 建议 Scene 4 的分辨率不超过 20×20

### Q3: 公式动画不工作？

**A**:

- Manim 的 `MathTex` 索引可能不稳定
- 代码中已使用 `get_part_by_tex()` 方法，更可靠
- 如果仍有问题，可以使用 `index_labels()` 调试索引

### Q4: 3D 场景坐标系错位？

**A**:

- 代码中已修复：使用 `VGroup` 整体居中，保持相对位置
- 确保 `axes_3d` 和 `pixel_grid` 打包在一起

### Q5: 如何调整视频时长？

**A**:

- 修改各场景中的 `run_time` 参数
- 调整 `wait()` 的时长
- 参考 `时长估算.md` 了解各场景的时长分配

---

## 📊 技术细节

### 数学基础

1. **泰勒展开**：
   - f(x+1) ≈ f(x) + f'(x) + ½f''(x)
   - f(x-1) ≈ f(x) - f'(x) + ½f''(x)
   - 相减得到：f'(x) ≈ [f(x+1) - f(x-1)] / 2

2. **中心差分法**：
   - 系数：[-1, 0, 1]
   - 精度：O(h²)，比前向/后向差分更精确

3. **Sobel算子**：
   - 水平方向：[-1, 0, 1] ⊗ [1, 2, 1]ᵀ
   - 垂直方向：[1, 2, 1] ⊗ [-1, 0, 1]ᵀ
   - 可分离性：3+3 次运算 vs 3×3 次运算

### 实现亮点

1. **幽灵效果**：Scene 1 中保留连续曲线作为背景，增强对比
2. **项的对撞**：Scene 2 中相同项高亮后消失，直观展示抵消过程
3. **全息扫描**：Scene 4 中使用角标和激光束，增强科技感
4. **实时示波器**：Scene 4 中 HUD 界面实时显示导数波形
5. **像素级放大镜**：Scene 4 中暂停扫描，展示卷积计算过程

---

## 📝 文件说明

### 必需文件（提交时包含）

1. **视频文件**：`数学与生活 - Sobel算子与视觉的微积分 - [学号姓名] - 视频.mp4`
2. **脚本文档**：`数学与生活 - Sobel算子与视觉的微积分 - [学号姓名] - 脚本.md`
3. **源代码**：`数学与生活 - Sobel算子与视觉的微积分 - [学号姓名] - 代码.py`
4. **说明文件**：`说明.md`（组员名单、文件说明）

### 辅助文件（可选）

- `README.md` - 本文件（技术文档）
- `旁白与剪辑指南.md` - 旁白脚本和剪辑建议
- `专家意见汇总.md` - 代码审查和优化建议
- `时长估算.md` - 各场景时长分析
- `提交指南.md` - 作业提交要求
- `提交检查清单.md` - 提交前检查清单

---

## 📄 许可证与原创声明

### 原创声明

**本作品所有内容均为原创**：

- ✅ 所有动画均由 Manim 编程生成
- ✅ 所有代码均为原创编写
- ✅ 所有旁白文案均为原创撰写
- ✅ 未使用任何外部图片、视频素材
- ✅ 未使用 AI 生成内容

### 使用的开源工具

- **Manim Community Edition**: MIT License
- **Python**: Python Software Foundation License
- **NumPy**: BSD License

### 数学理论来源

- 泰勒展开公式：标准数学理论
- 中心差分法：数值分析经典方法
- Sobel算子：计算机视觉经典算法（Irwin Sobel, 1968）
- 边缘检测理论：数字图像处理标准内容

详细素材来源标注请参见 `脚本文档.md`。

---

## 🙏 致谢

- **Manim Community** - 强大的数学动画制作工具
- **3Blue1Brown** - 数学可视化的灵感来源
- **数学分析课程** - 提供了项目背景和要求

---

## 📧 联系方式

如有问题或建议，请通过以下方式联系：

- **项目仓库**: [GitHub Repository]
- **问题反馈**: [Issues]

---

<div align="center">

**从数学理想（Δx → 0）到工程现实（pixel = 1）**

**知行合一，用离散的代码实现连续的数学理想**

---

*最后更新: 2024年12月*  
*文档版本: v2.0*

</div>
