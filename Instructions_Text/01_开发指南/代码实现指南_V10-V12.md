# 🛠️ 代码实现指南（合并版）

**对应代码版本**：V10-V12  
**文档编号**：V10-V12  
**主要架构说明**：
- V10 及之前：使用 `SobelUniverse(ThreeDScene)` 统一场景类
- V11-V12：使用独立场景类（`Scene0Intro`, `Scene1Discrete` 等）和 `FullSobelVideo` 编排类

**文档版本**：v1.0（合并版，替代原 3 个文件）

整合原《代码框架》《代码功能实现模块》《编码注意事项》，统一为唯一的实现参考。

---

## 一、全局规范
- 颜色语义池：`COLOR_CONTINUOUS`(理想/蓝)；`COLOR_DISCRETE`(采样/黄)；`COLOR_DIFF`(微分/红)；`COLOR_SMOOTH`(平滑/青)；`COLOR_GHOST`(背景/灰，`opacity≈0.2-0.3`)。
- 字体与模板：统一 `Tex/MathTex`；中文需 CJK/衬线模板；为矩阵引入 `amsmath`；字号分层（公式>字幕>注释）。
- 辅助函数：`get_downsampled_array(path, rate)` 降采样防卡死；字幕/标题封装（见代码示例文件）。
- 缓动与节奏：`play`/相机动作默认 `rate_func=smooth`；群体动画用 `LaggedStart`；出场/退场可加 `shift` 增强物理感。

---

## 二、场景模块

### V10 架构（`SobelUniverse(ThreeDScene)`）
- `construct`：按需注释掉未调试的场景便于分步渲染。
- Scene 1 `setup_scene_1_discrete`：连续→离散的对比；复制曲线做“幽灵”保留背景；采样柱严格对齐 `np.linspace` 点；可使用相机 zoom 聚焦采样点。
- Scene 2 `setup_scene_2_taylor`：泰勒“消消乐”；`substrings_to_isolate` 拆项；先变色再消去，保留 0.5s 停顿；必要时保留空缺再合并。
- Scene 3 `setup_scene_3_matrices`：向量外积→Sobel 3x3；颜色编码微分/平滑；`Brace` 标注功能；使用 `Transform`/`ReplacementTransform` 避免突兀。
- Scene 3.5 `setup_scene_35_noise`：噪声 vs 高斯平滑，对比展示；警示/结论字幕。
- Scene 4 `setup_scene_4_vision`：2D→3D；先 2D 锚定波形，再缓慢旋转相机；`array[::rate, ::rate]` 降采样生成 `Surface`；HUD 用 `add_fixed_in_frame_mobjects`。
- Scene 5 `setup_scene_5_outro`：复盘关键元素 + 原创声明；可用倒放蒙太奇 + 黑屏金句。

### V11-V12 架构（独立场景类 + `FullSobelVideo`）
- **独立场景类**：每个场景都是独立的 `Scene` 或 `ThreeDScene` 子类
  - `Scene0Intro`, `Scene1Discrete`, `Scene2Taylor` 等
- **编排类**：`FullSobelVideo(ThreeDScene)` 负责按顺序调用各场景的 `construct` 方法
- **优势**：代码更模块化，便于单独测试和调试每个场景
- **使用方法**：
  ```bash
  # 渲染单个场景（测试）
  manim -pql sobel_v12_full.py Scene4Vision
  
  # 渲染完整视频（所有场景）
  manim -pqh sobel_v12_full.py FullSobelVideo
  ```

---

## 三、工程细节与避坑
- 杜绝硬编码：颜色/尺寸/间距集中配置；统一常量池。
- 复制替身法：变形前先 `copy()`，原对象隐藏/透明，替身做背景（“幽灵”效果）。
- 对齐优先：并列元素用 `VGroup.arrange(..., aligned_edge=ORIGIN)`；字幕/说明用 `next_to(..., aligned_edge=LEFT, buff>=0.8)`。
- 3D 性能：`resolution` 与降采样一致；必要时降低线宽/淡出远处网格，避免摩尔纹；相机移动加缓动避免眩晕。
- 公式操控：`MathTex` 拆分子串；拓扑不匹配时用 `FadeOut + FadeIn` 代替生硬 `Transform`。

---

## 四、开发流程清单
- [ ] 先替换字体/色板/透明度，确保全局一致。
- [ ] 单场景调试：仅保留当前 `setup_scene_xxx()`，使用 `-pql` 预览。
- [ ] 关键帧检查：字幕避开主体；高亮框 `buff/圆角` 合理；箭头/指示明确。
- [ ] 3D 场景专检：降采样、相机缓动、HUD 贴屏。
- [ ] 最终合成前：
  - V10：恢复 `construct` 场景顺序，`-pqh` 渲染成品
  - V11-V12：使用 `FullSobelVideo` 类渲染完整视频

---

**文档版本**：v1.0（合并版，替代原 3 个文件）  
**适用版本**：V10-V12

