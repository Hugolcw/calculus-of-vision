
---

# 🛠️ 错误复盘报告：V15 版本依赖泄露问题

日期：2025年12月15日

模块：sobel_v15_full.py / utils_v15.py

错误类型：ImportError (导入错误)

## 1. 问题描述 (The Problem)

在尝试渲染 `sobel_v15_full.py` 的主场景 `FullSobelVideo` 时，程序崩溃并抛出以下异常：

> `ImportError: cannot import name 'ensure_safe_bounds' from 'utils_v13'`

## 2. 根本原因 (Root Cause)

这是一个典型的**依赖泄露（Dependency Leakage）**与**版本管理混乱**问题：

1. **功能缺失** ：主脚本试图从旧版本工具库 `utils_v13.py` 中导入一个名为 `ensure_safe_bounds` 的函数，但该函数实际上是 V14/V15 引入的新特性，并不存在于 V13 代码中。
2. **破坏了版本隔离** ：V15 版本的代码（`sobel_v15_full.py`）不应直接依赖底层旧版本库（`utils_v13.py`）的具体实现细节。V15 的主脚本应当只与 `utils_v15.py` 交互，由 `utils_v15.py` 负责处理所有的向下兼容和新功能封装。

## 3. 解决方案 (The Fix)

采取了**“封装底层，切断依赖”**的策略：

* 步骤一：打补丁（Patching utils_v15.py）
  在 utils_v15.py 文件末尾手动补充了 ensure_safe_bounds 函数的定义，使其成为 V15 工具包的一部分。
* 步骤二：修正引用（Updating sobel_v15_full.py）
  修改主脚本，删除了错误的 from utils_v13 import ... 语句，改为从 utils_v15 统一导入该函数。

## 4. 经验教训 (Key Takeaways)

* **版本隔离原则** ：在开发 `V(n)` 版本时，如果需要使用 `V(n-1)` 的功能，应通过 `utils_v(n)` 进行继承或封装，主脚本尽量不要跨级引用旧文件（如 `v15` 直接引 `v13`），否则一旦旧文件被清理或重构，新代码就会崩溃。
* **Import 检查** ：在复制粘贴旧代码片段到新文件时，务必检查 `import` 路径是否已更新为当前版本对应的模块。

---
